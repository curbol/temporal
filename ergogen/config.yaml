# Ergogen config file for TEMPORAL keyboard

# TEMPORAL, by curtis bollinger - @curbol
# https://github.com/curbol/temporal
# v1 - fall 2025

# ergogen help: https://flatfootfox.com/ergogen-part1-units-points/

# NOTE: the mcu and display footprint files have been edited to alter drill size to 0.85mm. Build from the footprints on the github repo, not ergogen's web client.

meta:
  engine: 4.1.0
  version: 1.0
  author: curtis bollinger
  url: https://github.com/curbol/temporal

units:
  # Proxy Spacing Variables
  kx: cx #choc spaced
  ky: cy
  # Padding Variables
  px: kx + 2
  py: ky + 2

  # Vertical offset of mcu area items
  voff: 7

  # Finger splay
  finger_splay: 8
  finger_spread: 0.5
  thumb_splay: 9

  # Tumb arc calculation
  thumb_angle_rad: thumb_splay * 3.1415926535 / 180
  thumb_arc_radius: 0.985kx / (2 * tan(thumb_angle_rad / 2))

  # Standoffs
  standoff_size: 5 # Size for standoff holes on pcb
  screen_standoff_size: 2

  # Top center
  hole1_x: -0.5 kx - 1
  hole1_y: -0.5 ky + 0.5

  # Top right
  hole2_x: -0.52 kx
  hole2_y: -0.35 ky

  # Right Thumb
  hole3_x: 0.5 kx + 0.6
  hole3_y: 0.0 ky - 0.5

  # Left Thumb
  hole4_x: 0kx - 0.5
  hole4_y: -0.6 ky

  # Far Left
  hole5_x: -0.5 kx - 0.6
  hole5_y: -0.6 ky + 1.5

  # Breakoff
  cut_w: 1.2
  cut_hoff: 2

  # Display correct choc sizing
  $default_width: 18
  $default_height: 17

  # Case
  bottom_thickness: 1.9
  wall_thickness: 1.2
  wall_height: 6 # Does not include bottom
  side_cut_width: 15
  side_cut_radius: 1.5

# ------------
# Points
# ------------
points:
  zones:
    finger:
      anchor.shift: [50, -100] # Fix KiCad placement
      key:
        padding: 1ky
        spread: 1kx
      columns:
        extra:
          rows.bottom.skip: true
          key.splay: finger_splay
          key.column_net: col_extra
        pinky:
          key.stagger: 0.5ky
          key.column_net: col_pinky
        ring:
          key.stagger: 0.35ky
          key.splay: -finger_splay/2
          key.spread: 1kx + finger_spread # Avoid collision on splayed col?
          key.column_net: col_ring
        middle:
          key.stagger: 0.25ky
          key.splay: -finger_splay/2
          key.spread: 1kx + finger_spread # Avoid collision on splayed col?
          key.column_net: col_middle
        index:
          key.stagger: -0.2ky
          key.column_net: col_index
        inner:
          key.stagger: -0.15ky
          key.column_net: col_inner
      rows:
        bottom:
          row_net: row_bottom
        home:
          row_net: row_home
        top:
          row_net: row_top

    thumb:
      key:
        padding: 1ky
        spread: 1kx
      anchor:
        ref: finger_middle_bottom
        shift: [0.4kx, -1.3ky]
      columns:
        encoder:
          key.name: thumb_enc
          key.column_net: col_ring
        near:
          key.splay: -thumb_splay
          key.origin: [-0.5kx, -0.5ky]
          key.name: thumb_near
          key.column_net: col_middle
        mid:
          key.splay: -thumb_splay
          key.origin: [-0.5kx, -0.5ky]
          key.name: thumb_mid
          key.column_net: col_index
        far:
          key.splay: -thumb_splay
          key.origin: [-0.5kx, -0.5ky]
          key.name: thumb_far
          key.column_net: col_inner
      rows:
        thumb:
          row_net: row_thumb

# ------------
# Outlines
# ------------
outlines:
  _keys:
    - what: rectangle
      where: true
      size: [px, py]

  _extra:
    - what: rectangle
      where:
        - finger_extra_top
        - finger_extra_home
      size: [1px, 3py]
      adjust:
        shift: [-0.1px, 0py]

  _key_plugs:
    - what: rectangle
      where: true
      size: [13.8, 13.8]

  _finger_fill:
    - what: rectangle
      where:
        - finger_pinky_top
        - finger_pinky_home
        - finger_ring_top
        - finger_ring_home
        - finger_ring_bottom
      size: [px, py]
      adjust:
        shift: [0.5px, 0py]

  _break_cut:
    - what: polygon
      fillet: 2
      points:
        - ref: finger_extra_top
          shift: [0.5px - cut_w / 2 - cut_hoff, 0.5py]
        - ref: finger_extra_top
          shift: [0px, 0.75py - cut_w * 1.25]
        - ref: finger_extra_top
          shift: [0px, 0.75py]
        - ref: finger_extra_top
          shift: [0.5px + cut_w / 2 - cut_hoff, 0.5py + cut_w / 2]
        - ref: finger_extra_home
          shift: [0.5px + cut_w / 2 - cut_hoff, -0.5py - cut_w / 2]
        - ref: finger_extra_home
          shift: [0px, -0.75py]
        - ref: finger_extra_home
          shift: [0px, -0.75py + cut_w * 1.25]
        - ref: finger_extra_home
          shift: [0.5px - cut_w / 2 - cut_hoff, -0.5py]
  _break_bridges:
    - what: rectangle
      where:
        ref: finger_extra_top
        shift: [0.5px - cut_hoff, 0.5py - 5.5]
      size: [cut_w * 2, 4]
    - what: rectangle
      where:
        ref: finger_extra_top
        shift: [0.5px - cut_hoff, -0.5py + 5]
      size: [cut_w * 2, 4]
    - what: rectangle
      where:
        ref: finger_extra_home
        shift: [0.5px - cut_hoff, 0.5py - 5.5]
      size: [cut_w * 2, 4]
    - what: rectangle
      where:
        ref: finger_extra_home
        shift: [0.5px - cut_hoff, -0.5py + 5]
      size: [cut_w * 2, 4]
  _break:
    - name: _break_cut
    - operation: subtract
      name: _break_bridges
      fillet: .5

  _thumb:
    - what: rectangle # Fill gap with finger keys
      where:
        - finger_index_bottom
        - finger_inner_bottom
      size: [px, py]
      adjust:
        shift: [0px, -0.5py]
    - what: polygon # Main thumb area
      points:
        - ref: thumb_far
          shift: [-1.5px, 0.5py]
        - ref: thumb_far
          shift: [-0.5px, 0.5py]
        - ref: thumb_far
          shift: [0.5px, 0.5py]
        - ref: thumb_far
          shift: [0.5px, -0.5py]
        - ref: thumb_far
          shift: [-0.5px, -0.5075py]
        - ref: thumb_near
          shift: [0.5px, -0.5py]
        - ref: thumb_enc
          shift: [0.5px, -0.5py]
        - ref: thumb_enc
          shift: [-0.5px, -0.5py]
        - ref: thumb_enc
          shift: [-0.5px, 1py]
        - ref: thumb_enc
          shift: [0.5px, 1py]
    # - what: polygon # Fill concave
    #   points:
    #     - ref: thumb_far
    #       shift: [0px, 0py]
    #     - ref: thumb_far
    #       shift: [0px, -0.5py]
    #     - ref: thumb_enc
    #       shift: [0px, -0.5py]
    #     - ref: thumb_enc
    #       shift: [0px, 0py]
    # - what: circle # Smooth concave cutout
    #   operation: subtract
    #   where:
    #     ref: thumb_enc
    #     shift: [0, -0.5py -thumb_arc_radius]
    #   radius: thumb_arc_radius

  _key_fill: [_keys, _finger_fill, _thumb]

  _socket:
    - what: rectangle # Center
      size: [2.7, 5]
      adjust:
        rotate: 42
        shift: [2, 5]
    - what: rectangle # Upper Left Big
      size: [4.1, 4.6]
      adjust:
        shift: [0, 5.95]
    - what: rectangle # Upper Left Small
      size: [2.6, 2.6]
      adjust:
        shift: [-3.3, 5.95]
    - what: rectangle # Lower Right Big
      size: [4.6, 4.7]
      adjust:
        shift: [4.75, 3.85]
    - what: rectangle # Lower Right Small
      size: [2.6, 2.6]
      expand: 0.3
      adjust:
        shift: [8.3, 3.735]
  _diode:
    - what: rectangle
      size: [4.2, 1.2]
      adjust:
        shift: [0, -5]
    - what: rectangle
      size: [2.8, 1.7]
      expand: 0.3
      adjust:
        shift: [0, -5]

  _socket_cutouts:
    - name: _socket
      where: true
      fillet: 0.3
  _diode_cutouts:
    - name: _diode
      where: true
      fillet: 0.3
  _socket_cutouts_small:
    - name: _socket_cutouts
    - operation: subtract
      name: _extra
      adjust:
        shift: [0.1px, 0py]
  _diode_cutouts_small:
    - name: _diode_cutouts
    - operation: subtract
      name: _extra
      adjust:
        shift: [0.1px, 0py]

  _mcu_area:
    - what: rectangle
      where:
        - ref: finger_inner_home
          shift: [20, -3 - voff]
      size: [21, 62]
  _display:
    - what: rectangle # Display
      where:
        ref: finger_inner_home
        shift: [19.8, 6.75 - voff]
      size: [10.8, 25.3]
      fillet: 0.5
  _mcu_cover_holes:
    - what: circle
      radius: screen_standoff_size / 2
      where:
        - ref: finger_inner_bottom
          shift: [0.5 kx + 4 + 0, -0.5 ky - 0]
    - what: circle
      radius: screen_standoff_size / 2
      where:
        - ref: finger_inner_bottom
          shift: [0.5 kx + 4 + 14, -0.5 ky - 6.5 - 0]

  _board_holes:
    - what: circle
      radius: 2.2 / 2
      where:
        - ref: finger_middle_top
          shift: [hole1_x, hole1_y]
    - what: circle
      radius: 2.2 / 2
      where:
        - ref: finger_inner_top
          shift: [hole2_x, hole2_y]
    - what: circle
      radius: 2.2 / 2
      where:
        - ref: thumb_mid
          shift: [hole3_x, hole3_y]
    - what: circle
      radius: 2.2 / 2
      where:
        - ref: finger_index_bottom
          shift: [hole4_x, hole4_y]
    - what: circle
      radius: 2.2 / 2
      where:
        - ref: finger_ring_home
          shift: [hole5_x, hole5_y]

  _case_cutout_template:
    - what: circle
      radius: side_cut_radius
      adjust:
        shift: [-(side_cut_width / 2) + side_cut_radius, -side_cut_radius]
    - what: circle
      radius: side_cut_radius
      adjust:
        shift: [(side_cut_width / 2) - side_cut_radius, -side_cut_radius]
    - what: rectangle
      size: [side_cut_width - side_cut_radius * 2, side_cut_radius * 4]
      adjust:
        shift: [0, 0]
    - what: rectangle
      size: [side_cut_width + side_cut_radius * 2, side_cut_radius * 2]
      adjust:
        shift: [0, 0]
    - what: circle
      operation: subtract
      radius: side_cut_radius
      adjust:
        shift: [-(side_cut_width / 2) - side_cut_radius, -side_cut_radius]
    - what: circle
      operation: subtract
      radius: side_cut_radius
      adjust:
        shift: [(side_cut_width / 2) + side_cut_radius, -side_cut_radius]
  _usbc_cutout:
    - name: _case_cutout_template
      where:
        - ref: finger_inner_home
          shift: [19.8, 25 + side_cut_radius * 2 - voff]
          rotate: 0
  _power_reset_cutout:
    - name: _case_cutout_template
      where:
        - ref: finger_inner_home
          shift: [27.5 + side_cut_radius * 2, -14.95 - voff]
          rotate: 90

  # Full Board
  board:
    - name: _key_fill
    - name: _mcu_area
      fillet: 1

  top_plate:
    - name: board
    - operation: subtract
      name: _board_holes

  case_inner:
    - name: board
      expand: 0.1
  case_outer:
    - name: case_inner
      expand: wall_thickness
      fillet: 1

  # Small Board
  board_small:
    - name: _key_fill
    - name: _mcu_area
    - operation: subtract
      name: _extra
      fillet: 1

  top_plate_small:
    - name: board_small
    - operation: subtract
      name: _board_holes

  case_inner_small:
    - name: board_small
      expand: 0.1
  case_outer_small:
    - name: case_inner_small
      expand: wall_thickness
      fillet: 1

  # Common
  pcb:
    - name: board
    - operation: subtract
      name: _break
      fillet: 1
  mcu_cover:
    - name: _mcu_area
    - operation: subtract
      name: _display
    - operation: subtract
      name: _key_fill
      fillet: 1
    - operation: subtract
      name: _mcu_cover_holes

# ------------
# Cases
# ------------
cases:
  temporal:
    - what: outline # Bottom
      name: case_outer
      extrude: bottom_thickness + wall_height
      shift: [0, 0, -bottom_thickness]
    - what: outline # Bottom socket cutouts (sockets are 1.85 tall)
      operation: subtract
      name: _socket_cutouts
      extrude: bottom_thickness * 2
      shift: [0, 0, -bottom_thickness * 1.5]
    - what: outline # Bottom diode cutouts (diodes are 1.15mm tall)
      operation: subtract
      name: _diode_cutouts
      extrude: bottom_thickness * 2
      shift: [0, 0, -1.2]
    - what: outline # Walls (cutout inner part)
      operation: subtract
      name: case_inner
      extrude: wall_height * 2
      shift: [0, 0, 0]
    - what: outline # Wall USB-C cutout
      operation: subtract
      name: _usbc_cutout
      extrude: 20
      shift: [0, 10, wall_height]
      rotate: [90, 0, 0]
    - what: outline # Wall power and reset cutouts
      operation: subtract
      name: _power_reset_cutout
      extrude: 10
      shift: [-5, 0, wall_height]
      rotate: [0, 90, 0]

# ------------
# PCBs
# ------------
pcbs:
  temporal:
    template: kicad8
    outlines:
      main:
        outline: pcb
    footprints:
      choc_hotswap:
        what: ceoloide/switch_choc_v1_v2
        where: true
        params:
          from: "{{colrow}}"
          to: "{{column_net}}"
          include_corner_marks: true
          include_keycap: true
          keycap_height: 16.5
          keycap_width: 17.5
          reversible: true
          hotswap: true
          choc_v2_support: false
          trace_width: 0.25
          via_size: 0.8
          via_drill: 0.4
      diode:
        what: ceoloide/diode_tht_sod123
        where: true
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
          include_tht: false
          reversible: true
          include_traces_vias: true
          via_size: 0.8
          via_drill: 0.4
        adjust:
          shift: [0, -5]
      encoder:
        what: ceoloide/rotary_encoder_ec11_ec12
        where:
          - ref: thumb_enc
        params:
          reversible: true
          include_plated_mounting_holes: false
          include_momentary_switch_pads: true
          smd_momentary_switch: true
          A: encoder_a # Left pin
          C: GND # Center pin
          B: encoder_b # Right pin
          S1: col_ring # Switch pin 1
          S2: encoder_thumb # Switch pin 2

      mcu:
        what: ceoloide/mcu_nice_nano
        where:
          - ref: finger_inner_home
            shift: [19.8, 10.8 - voff]
        params:
          reversible: true
          reverse_mount: true
          show_silk_labels: false
          # Finger rows
          P4: row_top
          P5: row_home
          P6: row_bottom
          P7: row_thumb
          # Finger columns
          P14: col_inner
          P15: col_index
          P18: col_middle
          P19: col_ring
          P20: col_pinky
          P21: col_extra
          # Encoder (using available pins)
          P0: encoder_a
          P1: encoder_b
          # SPI for nice!view
          P8: MOSI
          P9: SCK
          P10: CS
      display:
        what: ceoloide/display_nice_view
        params:
          reversible: true
          include_labels: false
        where:
          - ref: finger_inner_home
            shift: [19.8, 7.5 - voff]

      battery:
        what: ceoloide/battery_connector_jst_ph_2
        params:
          reversible: true
          include_traces_vias: true
          via_size: 0.8
          via_drill: 0.4
        where:
          - ref: finger_inner_home
            shift: [23.5, -14.5 - voff]
            rotate: -90

      power:
        what: ceoloide/power_switch_smd_side
        params:
          reversible: true
          include_traces_vias: true
          via_size: 0.8
          via_drill: 0.4
        where:
          - ref: finger_inner_home
            shift: [27.9, -18.5 - voff]
            rotate: 0
      reset:
        what: ceoloide/reset_switch_smd_side
        params:
          reversible: true
          include_traces_vias: true
          via_size: 0.8
          via_drill: 0.4
        where:
          - ref: finger_inner_home
            shift: [28.3, -10.2 - voff]
            rotate: -90

      temporal:
        what: ceoloide/utility_text
        where:
          - ref: finger_middle_bottom
            shift: [0, -0.65ky]
        params:
          text: "TEMPORAL"
          height: 2
          width: 2
          knockout: true
          reversible: true
      #ver:
      #  what: ceoloide/utility_text
      #  where:
      #    - ref: finger_index_home
      #      shift: [0.5kx, -0.5ky +1.45]
      #  params:
      #    text: "v 2"
      #    reversible: true

      curbol:
        what: ceoloide/utility_text
        where:
          - ref: thumb_far
            shift: [0, -3]
        params:
          text: "by curbol"
          reversible: true

      hole_1:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_middle_top
            shift: [hole1_x, hole1_y]

        params:
          hole_size: standoff_size
          hole_drill: standoff_size
      hole_2:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_inner_top
            shift: [hole2_x, hole2_y]
        params:
          hole_size: standoff_size
          hole_drill: standoff_size
      hole_3:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: thumb_mid
            shift: [hole3_x, hole3_y]
        params:
          hole_size: standoff_size
          hole_drill: standoff_size
      hole_4:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_index_bottom
            shift: [hole4_x, hole4_y]
        params:
          hole_size: standoff_size
          hole_drill: standoff_size
      hole_5:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_ring_home
            shift: [hole5_x, hole5_y]
        params:
          hole_size: standoff_size
          hole_drill: standoff_size

      # MCU cover holes
      hole_screen_L:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_inner_bottom
            shift: [0.5 kx + 4 + 0, -0.5 ky - 0]
        params:
          hole_size: screen_standoff_size
          hole_drill: screen_standoff_size
      hole_screen_R:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_inner_bottom
            shift: [0.5 kx + 4 + 14, -0.5 ky - 6.5 - 0]
        params:
          hole_size: screen_standoff_size
          hole_drill: screen_standoff_size

  temporal_top_plate:
    template: kicad8
    outlines:
      main:
        outline: top_plate
    footprints:
      hole_1:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_middle_top
            shift: [hole1_x, hole1_y]
      hole_2:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_inner_top
            shift: [hole2_x, hole2_y]
      hole_3:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: thumb_mid
            shift: [hole3_x, hole3_y]
      hole_4:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_index_bottom
            shift: [hole4_x, hole4_y]
      hole_5:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_ring_home
            shift: [hole5_x, hole5_y]

  temporal_top_plate_small:
    template: kicad8
    outlines:
      main:
        outline: top_plate_small
    footprints:
      hole_1:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_middle_top
            shift: [hole1_x, hole1_y]
      hole_2:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_inner_top
            shift: [hole2_x, hole2_y]
      hole_3:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: thumb_mid
            shift: [hole3_x, hole3_y]
      hole_4:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_index_bottom
            shift: [hole4_x, hole4_y]
      hole_5:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_ring_home
            shift: [hole5_x, hole5_y]

  temporal_mcu_cover:
    template: kicad8
    outlines:
      main:
        outline: mcu_cover
    footprints:
      hole_screen_L:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_inner_bottom
            shift: [0.5 kx + 4 + 0, -0.5 ky - 0]
        params:
          hole_size: screen_standoff_size
          hole_drill: screen_standoff_size
      hole_screen_R:
        what: ceoloide/mounting_hole_npth
        where:
          - ref: finger_inner_bottom
            shift: [0.5 kx + 4 + 14, -0.5 ky - 6.5 - 0]
        params:
          hole_size: screen_standoff_size
          hole_drill: screen_standoff_size
